<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Error Archive - ë¡œê·¸ì¸</title>

  <!-- CSS ë¶„ë¦¬ êµ¬ì¡° -->
  <link rel="stylesheet" href="assets/css/base.css">
  <link rel="stylesheet" href="assets/css/layout.css">
  <link rel="stylesheet" href="assets/css/form.css">
</head>

<body>
  <canvas id="snowCanvas"></canvas>
  <div class="main-container">
    <div class="logo-box">
      <img src="assets/logo_img_xmas.png" alt="Error Archive Logo" class="logo">
    </div>

    <div class="card-box">
      <form id="login-form">
        <label for="login">login</label>
        <input type="text" id="login" name="login" placeholder="ì•„ì´ë”” ì…ë ¥">

        <label for="pw">pw</label>
        <input type="password" id="pw" name="pw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">

        <div id="error-container"></div>
        <button type="submit" class="btn-primary">ë¡œê·¸ì¸</button>
      </form>

      <button class="login-btn kakao-btn" id="kakao-login">
        <img src="assets/kakao.png" alt="kakao_icon">
        Continue with Kakao
      </button>

      <button class="login-btn naver-btn" id="naver-login">
        <img src="assets/naver.png" alt="naver_icon">
        Continue with Naver
      </button>

      <div class="sub-links">
        <a href="signup">íšŒì›ê°€ì…</a> |
        <a href="find">ID/PW ì°¾ê¸°</a>
      </div>
    </div>
  </div>


  <!--ëˆˆë‚´ë¦¬ëŠ” ì½”ë“œ-->
  <script>
  const canvas = document.getElementById('snowCanvas');
  const ctx = canvas.getContext('2d');

  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let snowflakes = [];

  function createSnowflake() {
    const size = Math.random() * 2 + 1;
    return {
      x: Math.random() * canvas.width,
      y: Math.random() * -canvas.height,
      speed: Math.random() * 0.5 + 0.5,
      radius: size,
      drift: (Math.random() - 0.5) * 1
    };
  }

  function updateSnow() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    snowflakes.forEach(flake => {
      flake.y += flake.speed;
      flake.x += flake.drift;

      if (flake.y > canvas.height) {
        Object.assign(flake, createSnowflake());
        flake.y = 0;
      }

      ctx.beginPath();
      ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
      ctx.fill();
    });

    requestAnimationFrame(updateSnow);
  }

  function initSnow() {
    snowflakes = Array.from({ length: 200 }, createSnowflake);
    updateSnow();
  }

  window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    initSnow();
  });

  initSnow();
  </script>



  <script>
    const form = document.getElementById("login-form");
    const loginInput = document.getElementById("login");
    const pwInput = document.getElementById("pw");
    const errorContainer = document.getElementById("error-container");
    const loginBtn = document.querySelector(".btn-primary");

    // âœ… ì…ë ¥ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
    function updateLoginButton() {
      if (loginInput.value.trim() && pwInput.value.trim()) {
        loginBtn.style.opacity = "1";
        loginBtn.style.cursor = "pointer";
      } else {
        loginBtn.style.opacity = "0.6";
        loginBtn.style.cursor = "default";
      }
    }

    loginInput.addEventListener("input", updateLoginButton);
    pwInput.addEventListener("input", updateLoginButton);
    window.onload = updateLoginButton;

    // âœ… ì¼ë°˜ ë¡œê·¸ì¸ ìš”ì²­
    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      errorContainer.innerHTML = "";

      const login = loginInput.value.trim();
      const pw = pwInput.value.trim();

      if (!login && !pw) return showError("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      if (!login) return showError("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      if (!pw) return showError("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

      try {
        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ login, pw }),
        });

        const data = await res.json();

        if (data.success) {
          localStorage.setItem("user", JSON.stringify({
            userId: login,
            name: data.user.name,
            role: data.user.role
          }));
          alert(`${data.user?.name || login}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
          window.location.href = "list";
        } else {
          showError(data.message || "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }
      } catch (err) {
        console.error("ğŸš¨ ì„œë²„ ì—°ê²° ì˜¤ë¥˜:", err);
        showError("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      }
    });

    // âœ… ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ
    document.getElementById("kakao-login").addEventListener("click", () => {
      window.location.href = "/auth/kakao";
    });

    // âœ… ë„¤ì´ë²„ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ
    document.getElementById("naver-login").addEventListener("click", () => {
      window.location.href = "/auth/naver";
    });

    // âœ… ì—ëŸ¬ í‘œì‹œ í•¨ìˆ˜
    function showError(msg) {
      const div = document.createElement("div");
      div.className = "error-msg";
      div.textContent = msg;
      errorContainer.innerHTML = "";
      errorContainer.appendChild(div);
      makeButtonDim();
    }

    function makeButtonDim() {
      loginBtn.style.opacity = "0.6";
      loginBtn.style.cursor = "default";
    }
  </script>

  <!-- ì±—ë´‡ UI -->
  <button id="chatbot-toggle">ğŸ’¬</button>
  
  <div id="chatbot-container" style="display: none;">
    <div id="chatbot-header">
      <span>ğŸ’¬ ì±—ë´‡ ë„ìš°ë¯¸</span>
      <button id="chatbot-close">âœ•</button>
    </div>
    <div id="chatbot-messages"></div>
  <div id="quick-replies"></div>
  <div id="chatbot-input-container">
    <button id="voice-input-btn" title="ìŒì„± ì…ë ¥">ğŸ¤</button>
    <input type="text" id="chatbot-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
    <button id="chatbot-send">ì „ì†¡</button>
  </div>
  </div>

  <style>
  #chatbot-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 350px;
    height: 500px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    z-index: 10000;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  #chatbot-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px;
    border-radius: 10px 10px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #chatbot-close {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
  }

  #chatbot-messages {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    background: #f5f5f5;
  }

  .message {
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
  }

  .message.user {
    align-items: flex-end;
  }

  .message.bot {
    align-items: flex-start;
  }

  .message-bubble {
    max-width: 80%;
    padding: 10px 15px;
    border-radius: 18px;
    word-wrap: break-word;
  }

  .message.user .message-bubble {
    background: #667eea;
    color: white;
  }

  .message.bot .message-bubble {
    background: white;
    color: #333;
    border: 1px solid #e0e0e0;
  }

  #chatbot-input-container {
    display: flex;
    padding: 10px;
    border-top: 1px solid #e0e0e0;
    background: white;
    border-radius: 0 0 10px 10px;
  }

  #chatbot-input {
    flex: 1;
    padding: 10px;
    border: 1px solid #e0e0e0;
    border-radius: 20px;
    outline: none;
    margin-right: 10px;
  }

  #chatbot-send {
    padding: 10px 20px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
  }

  #chatbot-send:hover {
    background: #5568d3;
  }

  #chatbot-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s;
  }

  #chatbot-toggle:hover {
    transform: scale(1.1);
  }

  /* íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜ */
  .typing-indicator {
    display: flex;
    gap: 4px;
    padding: 10px;
  }

  .typing-indicator span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #999;
    animation: typing 1.4s infinite;
  }

  .typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
  }

  .typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes typing {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-10px); }
  }

  /* ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ */
  #quick-replies {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 10px;
    border-top: 1px solid #e0e0e0;
    background: #f9f9f9;
  }

  .quick-reply-btn {
    padding: 8px 12px;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s;
  }

  .quick-reply-btn:hover {
    background: #667eea;
    color: white;
    border-color: #667eea;
  }

  /* ìŒì„± ì…ë ¥ ë²„íŠ¼ */
  #voice-input-btn {
    background: none;
    border: none;
    color: #667eea;
    font-size: 18px;
    cursor: pointer;
    padding: 5px 10px;
  }

  #voice-input-btn.recording {
    color: #ff4444;
    animation: pulse 1s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  </style>

  <script>
  // ì±—ë´‡ ë¡œì§ (ê³ ê¸‰ ê¸°ëŠ¥ í¬í•¨)
  (function() {
    const chatbotContainer = document.getElementById('chatbot-container');
    const chatbotToggle = document.getElementById('chatbot-toggle');
    const chatbotClose = document.getElementById('chatbot-close');
    const chatbotMessages = document.getElementById('chatbot-messages');
    const chatbotInput = document.getElementById('chatbot-input');
    const chatbotSend = document.getElementById('chatbot-send');
    const quickReplies = document.getElementById('quick-replies');
    const voiceInputBtn = document.getElementById('voice-input-btn');

    // ëŒ€í™” íˆìŠ¤í† ë¦¬ ì €ì¥ (ì»¨í…ìŠ¤íŠ¸ ê¸°ì–µ)
    let conversationHistory = [];
    let isTyping = false;

    // ì±—ë´‡ í† ê¸€
    chatbotToggle.addEventListener('click', () => {
      chatbotContainer.style.display = chatbotContainer.style.display === 'none' ? 'flex' : 'none';
      chatbotToggle.style.display = chatbotContainer.style.display === 'none' ? 'flex' : 'none';
    });

    chatbotClose.addEventListener('click', () => {
      chatbotContainer.style.display = 'none';
      chatbotToggle.style.display = 'flex';
    });

    // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì¶”ê°€
    function addTypingIndicator() {
      if (isTyping) return;
      isTyping = true;
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message bot typing';
      typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
      chatbotMessages.appendChild(typingDiv);
      chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
    }

    // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì œê±°
    function removeTypingIndicator() {
      const typing = chatbotMessages.querySelector('.typing');
      if (typing) typing.remove();
      isTyping = false;
    }

    // ë©”ì‹œì§€ ì¶”ê°€ (ì»¨í…ìŠ¤íŠ¸ ê¸°ì–µ í¬í•¨)
    function addMessage(text, isUser) {
      // ëŒ€í™” íˆìŠ¤í† ë¦¬ì— ì €ì¥
      conversationHistory.push({ 
        text, 
        isUser, 
        timestamp: Date.now() 
      });
      
      // ìµœê·¼ 10ê°œë§Œ ìœ ì§€
      if (conversationHistory.length > 10) {
        conversationHistory.shift();
      }

      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
      
      const bubble = document.createElement('div');
      bubble.className = 'message-bubble';
      
      // ì¤„ë°”ê¿ˆ ì²˜ë¦¬
      const lines = text.split('\n');
      lines.forEach((line, index) => {
        if (index > 0) bubble.appendChild(document.createElement('br'));
        bubble.appendChild(document.createTextNode(line));
      });
      
      messageDiv.appendChild(bubble);
      chatbotMessages.appendChild(messageDiv);
      chatbotMessages.scrollTop = chatbotMessages.scrollHeight;

      // ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      updateQuickReplies();
    }

    // ì˜ë„ íŒŒì•… (ìì—°ì–´ ì²˜ë¦¬ ê°œì„ )
    function detectIntent(message) {
      const intents = {
        greeting: ['ì•ˆë…•', 'hello', 'hi', 'í•˜ì´', 'í—¬ë¡œ'],
        login: ['ë¡œê·¸ì¸', 'login', 'ì ‘ì†', 'ë¡œê·¸'],
        signup: ['íšŒì›ê°€ì…', 'ê°€ì…', 'signup', 'ë“±ë¡'],
        password: ['ë¹„ë°€ë²ˆí˜¸', 'password', 'ì°¾ê¸°', 'pw', 'ë¹„ë²ˆ'],
        help: ['ë„ì›€', 'help', 'ë„ì™€', 'ì–´ë–»ê²Œ', 'ë°©ë²•'],
        service: ['ì„œë¹„ìŠ¤', 'ì†Œê°œ', 'ë­', 'what', 'ë¬´ì—‡', 'ì—ëŸ¬ì•„ì¹´ì´ë¸Œ'],
        error: ['ì—ëŸ¬', 'error', 'ì˜¤ë¥˜', 'ë¬¸ì œ', 'ë²„ê·¸'],
        thanks: ['ê³ ë§ˆì›Œ', 'ê°ì‚¬', 'thanks', 'thank', 'ê³ ë§™']
      };
      
      const msg = message.toLowerCase();
      for (const [intent, keywords] of Object.entries(intents)) {
        if (keywords.some(keyword => msg.includes(keyword))) {
          return intent;
        }
      }
      return 'unknown';
    }

    // ì±—ë´‡ ì‘ë‹µ ìƒì„± (ë¡œì»¬ + API)
    async function getBotResponse(userMessage) {
      const intent = detectIntent(userMessage);
      const message = userMessage.toLowerCase().trim();
      
      // ë¡œì»¬ ê·œì¹™ ê¸°ë°˜ ì‘ë‹µ
      let response = getLocalResponse(intent, message);
      
      // ë°±ì—”ë“œ API ì—°ë™ ì‹œë„
      try {
        const apiResponse = await fetch('/api/chatbot', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            message: userMessage,
            intent: intent,
            history: conversationHistory.slice(-3) // ìµœê·¼ 3ê°œë§Œ ì „ì†¡
          })
        });
        
        if (apiResponse.ok) {
          const data = await apiResponse.json();
          if (data.response) {
            response = data.response;
            // ëŒ€í™” ë¡œê·¸ ì €ì¥
            saveConversationLog(userMessage, response);
          }
        }
      } catch (error) {
        console.log('API í˜¸ì¶œ ì‹¤íŒ¨, ë¡œì»¬ ì‘ë‹µ ì‚¬ìš©');
      }
      
      return response;
    }

    // ë¡œì»¬ ì‘ë‹µ ìƒì„±
    function getLocalResponse(intent, message) {
      switch(intent) {
        case 'greeting':
          const user = JSON.parse(localStorage.getItem('user'));
          if (user) {
            return `ì•ˆë…•í•˜ì„¸ìš”, ${user.name}ë‹˜! Error Archive ì±—ë´‡ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?`;
          }
          return 'ì•ˆë…•í•˜ì„¸ìš”! Error Archive ì±—ë´‡ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?';
        
        case 'login':
          return 'ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ì¹´ì¹´ì˜¤ë‚˜ ë„¤ì´ë²„ ê³„ì •ìœ¼ë¡œë„ ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ìš”!';
        
        case 'signup':
          return 'íšŒì›ê°€ì…ì€ ìƒë‹¨ì˜ "íšŒì›ê°€ì…" ë§í¬ë¥¼ í´ë¦­í•˜ì‹œë©´ ë©ë‹ˆë‹¤.';
        
        case 'password':
          return 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ìœ¼ì‹œë ¤ë©´ ìƒë‹¨ì˜ "ID/PW ì°¾ê¸°" ë§í¬ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.';
        
        case 'help':
          return 'ë‹¤ìŒê³¼ ê°™ì€ ì§ˆë¬¸ì— ë‹µë³€í•  ìˆ˜ ìˆì–´ìš”:\n- ë¡œê·¸ì¸ ë°©ë²•\n- íšŒì›ê°€ì…\n- ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°\n- ì„œë¹„ìŠ¤ ì†Œê°œ\n- ì—ëŸ¬ ë¡œê·¸ ê´€ë¦¬';
        
        case 'service':
          return 'Error ArchiveëŠ” ì—ëŸ¬ ë¡œê·¸ë¥¼ ê´€ë¦¬í•˜ê³  ë¶„ì„í•˜ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ê°œë°œìë“¤ì´ ì—ëŸ¬ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ë“œë ¤ìš”!';
        
        case 'error':
          return 'ì—ëŸ¬ ë¡œê·¸ë¥¼ ê´€ë¦¬í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ ë¡œê·¸ì¸ í›„ ê²Œì‹œíŒì—ì„œ ì—ëŸ¬ë¥¼ ë“±ë¡í•˜ê³  í•´ê²° ë°©ë²•ì„ ê³µìœ í•  ìˆ˜ ìˆì–´ìš”!';
        
        case 'thanks':
          return 'ì²œë§Œì—ìš”! ğŸ˜Š ë‹¤ë¥¸ ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“ ì§€ ë§ì”€í•´ì£¼ì„¸ìš”!';
        
        default:
          const responses = [
            'ì£„ì†¡í•´ìš”, ê·¸ ì§ˆë¬¸ì— ëŒ€í•´ ì •í™•íˆ ë‹µë³€ë“œë¦¬ê¸° ì–´ë ¤ì›Œìš”. ë‹¤ë¥¸ ì§ˆë¬¸ì„ í•´ì£¼ì‹œê² ì–´ìš”?',
            'ì¢€ ë” êµ¬ì²´ì ìœ¼ë¡œ ì§ˆë¬¸í•´ì£¼ì‹œë©´ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”!',
            'ë¡œê·¸ì¸, íšŒì›ê°€ì…, ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°, ì„œë¹„ìŠ¤ ì†Œê°œ ë“±ì— ëŒ€í•´ ë¬¼ì–´ë³´ì‹¤ ìˆ˜ ìˆì–´ìš”.',
          ];
          return responses[Math.floor(Math.random() * responses.length)];
      }
    }

    // ëŒ€í™” ë¡œê·¸ ì €ì¥
    function saveConversationLog(question, answer) {
      try {
        fetch('/api/chatbot/logs', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            question: question,
            answer: answer,
            timestamp: new Date().toISOString()
          })
        }).catch(err => console.log('ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', err));
      } catch (error) {
        console.log('ë¡œê·¸ ì €ì¥ ì˜¤ë¥˜:', error);
      }
    }

    // ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ ì—…ë°ì´íŠ¸
    function updateQuickReplies() {
      quickReplies.innerHTML = '';
      const replies = ['ë¡œê·¸ì¸ ë°©ë²•', 'íšŒì›ê°€ì…', 'ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°', 'ì„œë¹„ìŠ¤ ì†Œê°œ'];
      
      replies.forEach(reply => {
        const button = document.createElement('button');
        button.className = 'quick-reply-btn';
        button.textContent = reply;
        button.onclick = () => {
          chatbotInput.value = reply;
          sendMessage();
        };
        quickReplies.appendChild(button);
      });
    }

    // ë©”ì‹œì§€ ì „ì†¡ (íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜ í¬í•¨)
    async function sendMessage() {
      const message = chatbotInput.value.trim();
      if (!message) return;
      
      addMessage(message, true);
      chatbotInput.value = '';
      
      // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
      addTypingIndicator();
      
      // ì±—ë´‡ ì‘ë‹µ (API í˜¸ì¶œ í¬í•¨)
      try {
        const response = await getBotResponse(message);
        removeTypingIndicator();
        
        // ìì—°ìŠ¤ëŸ¬ìš´ ì§€ì—° í›„ ì‘ë‹µ
        setTimeout(() => {
          addMessage(response, false);
        }, 300);
      } catch (error) {
        removeTypingIndicator();
        addMessage('ì£„ì†¡í•´ìš”, ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', false);
      }
    }

    // ìŒì„± ì…ë ¥ ê¸°ëŠ¥
    let recognition = null;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      recognition = new (window.webkitSpeechRecognition || window.SpeechRecognition)();
      recognition.lang = 'ko-KR';
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        chatbotInput.value = transcript;
        sendMessage();
      };

      recognition.onerror = (event) => {
        console.log('ìŒì„± ì¸ì‹ ì˜¤ë¥˜:', event.error);
        voiceInputBtn.classList.remove('recording');
      };

      recognition.onend = () => {
        voiceInputBtn.classList.remove('recording');
      };

      voiceInputBtn.addEventListener('click', () => {
        if (recognition && !voiceInputBtn.classList.contains('recording')) {
          voiceInputBtn.classList.add('recording');
          recognition.start();
        } else if (recognition) {
          recognition.stop();
          voiceInputBtn.classList.remove('recording');
        }
      });
    } else {
      voiceInputBtn.style.display = 'none';
    }

    chatbotSend.addEventListener('click', sendMessage);
    chatbotInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // ì´ˆê¸° ë©”ì‹œì§€ ë° ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼
    setTimeout(() => {
      addMessage('ì•ˆë…•í•˜ì„¸ìš”! Error Archive ì±—ë´‡ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?', false);
      updateQuickReplies();
    }, 500);
  })();
  </script>
</body>
</html>


